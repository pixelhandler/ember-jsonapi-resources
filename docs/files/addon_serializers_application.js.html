<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>addon/serializers/application.js - Ember JSON API Resources</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="Ember JSON API Resources" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.2.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/ApplicationAdapter.html">ApplicationAdapter</a></li>
                                <li><a href="../classes/ApplicationSerializer.html">ApplicationSerializer</a></li>
                                <li><a href="../classes/AuthorizationMixin.html">AuthorizationMixin</a></li>
                                <li><a href="../classes/FetchMixin.html">FetchMixin</a></li>
                                <li><a href="../classes/RelatedProxyUtil.html">RelatedProxyUtil</a></li>
                                <li><a href="../classes/Resource.html">Resource</a></li>
                                <li><a href="../classes/ServiceCacheMixin.html">ServiceCacheMixin</a></li>
                                <li><a href="../classes/StoreService.html">StoreService</a></li>
                                <li><a href="../classes/TransformDateAttribute.html">TransformDateAttribute</a></li>
                                <li><a href="../classes/TransformMap.html">TransformMap</a></li>
                                <li><a href="../classes/TransformsMixin.html">TransformsMixin</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/adapters.html">adapters</a></li>
                                <li><a href="../modules/authorization.html">authorization</a></li>
                                <li><a href="../modules/cache.html">cache</a></li>
                                <li><a href="../modules/ember-jsonapi-resources.html">ember-jsonapi-resources</a></li>
                                <li><a href="../modules/fetch.html">fetch</a></li>
                                <li><a href="../modules/initializers.html">initializers</a></li>
                                <li><a href="../modules/resource.html">resource</a></li>
                                <li><a href="../modules/serializers.html">serializers</a></li>
                                <li><a href="../modules/store.html">store</a></li>
                                <li><a href="../modules/transform-map.html">transform-map</a></li>
                                <li><a href="../modules/transforms.html">transforms</a></li>
                                <li><a href="../modules/utils.html">utils</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: addon/serializers/application.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
  @module ember-jsonapi-resources
  @submodule serializers
**/

import Ember from &#x27;ember&#x27;;
import { singularize, pluralize } from &#x27;ember-inflector&#x27;;

/**
  Serializer/Deserializer for a JSON API resource object, used by adapter.

  When extending use a mixin or define transform methods to serialize and/or
  deserializer attributes based on the name or the type of attribute.

  The methods use a naming convention:

    - &#x27;[de]serialize&#x27; + &#x27;AttrName&#x27; or &#x27;TypeName&#x27; + &#x27;Attribute&#x27;
    - E.g. use &#x60;serializeNameAttribute&#x60; and &#x60;deserializeNameAttribute&#x60; in
      a generated serializer for use with &#x60;name: attr()&#x60;
    - Or, redefine &#x60;serializeDateAttribute&#x60; and &#x60;deserializeDateAttribute&#x60;
      to use your own data transformation with &#x60;attr(&#x27;date&#x27;)&#x60; the default,
      Date type [de]serialize methods transfrom to/from ISO Format.
    - Transform methods based on the name of the attribute will be called
      instead of any transform methods based on the type of the attribute.

  @class ApplicationSerializer
  @static
*/
export default Ember.Object.extend({

  /**
    Serialize resource for the request payload

    @method serialize
    @param {Resource|Array} resource - object to serialize
    @return {Object|Array}
  */
  serialize(resources) {
    const json = { data: null };
    if (Array.isArray(resources)) {
      json.data = this.serializeResources(resources);
    } else if (typeof resources === &#x27;object&#x27;) {
      json.data = this.serializeResource(resources);
    } else {
      json.data = {};
    }
    return json;
  },

  /**
    @method serializeResources
    @param {Array} collection
    @return {Array}
  */
  serializeResources(collection) {
    for (let i = 0; i &lt; collection.length; i++) {
      collection[i] = this.serializeResource(collection[i]);
    }
    return collection;
  },

  /**
    Serialize a resource object

    @method serializeResource
    @param {Resource} object to serialize
    @return {Object}
  */
  serializeResource(resource) {
    let json = resource.getProperties(&#x27;type&#x27;, &#x27;attributes&#x27;, &#x27;relationships&#x27;);
    json = this.transformAttributes(json, &#x27;serialize&#x27;);
    for (let relationship in json.relationships) {
      if (json.relationships.hasOwnProperty(relationship)) {
        delete json.relationships[relationship].links;
        if (!json.relationships[relationship].data) {
          delete json.relationships[relationship];
        }
      }
    }
    return json;
  },

  /**
    Serialize a resource object, but only the changed attributes

    @method serializeChanged
    @param {Resource} object to serialize
    @return {Object}
  */
  serializeChanged(resource) {
    let json = resource.getProperties(&#x27;id&#x27;, &#x27;type&#x27;, &#x27;changedAttributes&#x27;);
    if (Ember.isEmpty(Object.keys(json.changedAttributes))) { return null; }
    let serialized = {
      data: {
        type: json.type,
        id: json.id,
        attributes: json.changedAttributes
      }
    };
    serialized.data = this.transformAttributes(serialized.data, &#x27;serialize&#x27;);
    return serialized;
  },

  /**
    Deserialize response objects from the request payload

    @method deserialize
    @param {Object} json - response object, extract resource(s)
    @return {Ember.Array|Resource}
  */
  deserialize(json) {
    if (Array.isArray(json.data)) {
      return this.deserializeResources(Ember.A(json.data));
    } else if (typeof json.data === &#x27;object&#x27;) {
      return this.deserializeResource(json.data);
    } else {
      return null;
    }
  },

  /**
    Deserialize response objects in the payload data

    @method deserializeResources
    @param {Array} collection
    @return {Object|Ember.Array}
  */
  deserializeResources(collection) {
    for (let i = 0; i &lt; collection.length; i++) {
      collection[i] = this.deserializeResource(collection[i]);
    }
    return collection;
  },

  /**
    Deserialize response an object in the payload data

    @method deserializeResource
    @param {Object} json
    @return {Resource}
  */
  deserializeResource(json) {
    json = this.transformAttributes(json);
    return this._createResourceInstance(json);
  },

  /**
    Deserialize optional included array of payload and add to service cache

    @method deserializeIncluded
    @param {Array} related
    @param {Object} resp (optional) e.g. headers, meta, etc.
  */
  deserializeIncluded(related, resp) {
    if (!related) { return; }
    let resource, service;
    for (let i = 0; i &lt; related.length; i++) {
      let owner = (typeof Ember.getOwner === &#x27;function&#x27;) ? Ember.getOwner(this) : this.container;
      service = owner.lookup(&#x27;service:&#x27; + pluralize(related[i].type));
      if (service &amp;&amp; service.cache &amp;&amp; service.cache.data) {
        resource = service.serializer.deserializeResource(related[i]);
        service.cacheResource({ meta: resp.meta, data: resource, headers: resp.headers});
      }
    }
  },

  /**
    Transform attributes, serialize or deserialize by specified method or
    per type of attribute, e.g. date.

    Your serializer may define a specific method for a type of attribute,
    i.e. &#x60;serializeDateAttribute&#x60; and/or &#x60;deserializeDateAttribute&#x60;. Likewise,
    your serializer may define a specific method for the name of an attribute,
    like &#x60;serializeUpdatedAtAttribute&#x60; and &#x60;deserializeUpdatedAtAttribute&#x60;.

    During transformation a method based on the name of the attribute takes
    priority over a transform method based on the type of attribute, e.g. date.

    @method transformAttributes
    @param {Object} json with attributes hash of resource properties to be transformed
    @param {String} [operation=&#x27;deserialize&#x27;] perform a serialize or deserialize
      operation, the default operation is to deserialize when not passed
    @return {Object} json
  */
  transformAttributes(json, operation = &#x27;deserialize&#x27;) {
    assertTranformOperation(operation);
    let transformMethod, factory, meta;
    for (let attr in json.attributes) {
      transformMethod = transformMethodName(operation, attr);
      if (typeof this[transformMethod] === &#x27;function&#x27;) {
        json.attributes[attr] = this[transformMethod](json.attributes[attr]);
      } else {
        try {
          factory = this._lookupFactory(json.type);
          meta = factory.metaForProperty(attr);
          transformMethod = transformMethodName(operation, meta.type);
          if (typeof this[transformMethod] === &#x27;function&#x27;) {
            json.attributes[attr] = this[transformMethod](json.attributes[attr]);
          }
        } catch (e) {
          continue; // metaForProperty has an assertion that may throw
        }
      }
    }
    return json;
  },

  /**
    Create a Resource from a JSON API Resource Object

    See &lt;http://jsonapi.org/format/#document-resource-objects&gt;

    @private
    @method _createResourceInstance
    @param {Object} json
    @return (Resource) instance
  */
  _createResourceInstance(json) {
    let resource = {
      &#x27;type&#x27;: json.type,
      &#x27;id&#x27;: json.id,
      &#x27;attributes&#x27;: json.attributes,
      &#x27;relationships&#x27;: json.relationships,
      &#x27;links&#x27;: json.links,
      &#x27;meta&#x27;: json.meta
    };
    for (let prop in resource) {
      if (!resource[prop]) {
        delete resource[prop];
      }
    }
    return this._lookupFactory(json.type).create(resource);
  },

  /**
    @private
    @method _lookupFactory
    @param {String} type
    @return {Function} factory for creating resource instances
  */
  _lookupFactory(type) {
    let owner = (typeof Ember.getOwner === &#x27;function&#x27;) ? Ember.getOwner(this) : this.container;
    return owner.lookup(&#x27;model:&#x27; + singularize(type));
  }
});

const tranformOperations = [&#x27;serialize&#x27;, &#x27;deserialize&#x27;];

function assertTranformOperation(operation) {
  Ember.assert(&#x60;${operation} is not a valid transform operation&#x60;, tranformOperations.indexOf(operation) &gt; -1);
}

function transformMethodName(operation, attrName) {
  return [operation, Ember.String.classify(attrName), &#x27;Attribute&#x27;].join(&#x27;&#x27;);
}

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
