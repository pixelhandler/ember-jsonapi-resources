<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>addon/mixins/resource-operations.js - Ember JSON API Resources</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="Ember JSON API Resources" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.2.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/AdapterApiHostProxyMixin.html">AdapterApiHostProxyMixin</a></li>
                                <li><a href="../classes/ApplicationAdapter.html">ApplicationAdapter</a></li>
                                <li><a href="../classes/ApplicationSerializer.html">ApplicationSerializer</a></li>
                                <li><a href="../classes/AuthorizationMixin.html">AuthorizationMixin</a></li>
                                <li><a href="../classes/RelatedProxyUtil.html">RelatedProxyUtil</a></li>
                                <li><a href="../classes/Resource.html">Resource</a></li>
                                <li><a href="../classes/ResourceOperationsMixin.html">ResourceOperationsMixin</a></li>
                                <li><a href="../classes/ServiceCacheMixin.html">ServiceCacheMixin</a></li>
                                <li><a href="../classes/StoreService.html">StoreService</a></li>
                                <li><a href="../classes/TransformDateAttribute.html">TransformDateAttribute</a></li>
                                <li><a href="../classes/TransformMap.html">TransformMap</a></li>
                                <li><a href="../classes/TransformsMixin.html">TransformsMixin</a></li>
                                <li><a href="../classes/Utils.html">Utils</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/adapter-api-host-proxy-mixin.html">adapter-api-host-proxy-mixin</a></li>
                                <li><a href="../modules/adapters.html">adapters</a></li>
                                <li><a href="../modules/authorization.html">authorization</a></li>
                                <li><a href="../modules/cache.html">cache</a></li>
                                <li><a href="../modules/ember-jsonapi-resources.html">ember-jsonapi-resources</a></li>
                                <li><a href="../modules/initializers.html">initializers</a></li>
                                <li><a href="../modules/resource.html">resource</a></li>
                                <li><a href="../modules/resource-operations.html">resource-operations</a></li>
                                <li><a href="../modules/serializers.html">serializers</a></li>
                                <li><a href="../modules/store.html">store</a></li>
                                <li><a href="../modules/transforms.html">transforms</a></li>
                                <li><a href="../modules/utils.html">utils</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: addon/mixins/resource-operations.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
  @module ember-jsonapi-resources
  @submodule resource-operations
**/
import Ember from &#x27;ember&#x27;;

/**
  Mixin to provide interations between a Resource instance and service/adapter.

  @class ResourceOperationsMixin
  @static
*/
export default Ember.Mixin.create({
  /**
    The service object for the entity (adapter with cache and serializer)

    @property service
    @type Object
    @required
  */
  service: Ember.required,

  /**
    Create a new resource, calls service to persist new model

    - See: &lt;http://jsonapi.org/format/#crud-creating&gt;

    Calling &#x60;this.createResource&#x60; will call the service to persist the new model,
    via it&#x27;s &#x60;createResource&#x60; method.

    @method createResource
    @return {Promise}
  */
  createResource() {
    return this.get(&#x27;service&#x27;).createResource(this);
  },

  /**
    Update a persistend resource, calls service to persist changes

    - See: &lt;http://jsonapi.org/format/#crud-updating&gt;

    Calling &#x60;this.updateResource&#x60; will call the service to persist the changes,
    via it&#x27;s &#x60;updateResource&#x60; method.

    @method updateResource
    @return {Promise}
  */
  updateResource() {
    return this.get(&#x27;service&#x27;).updateResource(this);
  },

  /**
    Delete a persistend resource, calls service to DELETE via API request

    - See: &lt;http://jsonapi.org/format/#crud-deleting&gt;

    Calling &#x60;this.deleteResource&#x60; will call the service to remove the destroy,
    via it&#x27;s &#x60;deleteResource&#x60; method.

    @method deleteResource
    @return {Promise}
  */
  deleteResource() {
    return this.get(&#x27;service&#x27;).deleteResource(this);
  },

  /**
    Create a relationship for a &#x60;to-many&#x60; relation, calls service to persist.

    See: &lt;http://jsonapi.org/format/#crud-updating-to-many-relationships&gt;

    Calling &#x60;this.createRelationship&#x60; will call the service to persist the changes,
    via it&#x27;s &#x60;createRelationship&#x60; method. Since the default &#x60;catch&#x60; for this
    method is to rollback the relationships, an optional &#x60;errorCallback&#x60; function
    can be used to handle the error response.

    @method createRelationship
    @param {String} relationship name (plural) to find the url
    @param {String} id of the related resource
    @param {Function} errorCallback &#x60;function (error) {}&#x60;
    @return {Promise}
  */
  createRelationship(relationship, id, errorCallback) {
    this.addRelationship(relationship, id);
    return this.get(&#x27;service&#x27;).createRelationship(this, relationship, id)
    .catch(function (error) {
      this.removeRelationship(relationship, id);
      if (typeof errorCallback === &#x27;function&#x27;) {
        errorCallback(error);
      } else {
        Ember.Logger.error(error);
      }
    }.bind(this));
  },

  /**
    Update a relationship, works with both &#x60;to-many&#x60; and &#x60;to-one&#x60;. Primarily use
    with &#x60;to-one&#x60; and &#x60;to-many&#x60; is for a full replacement only.

    For a &#x60;to-one&#x60; relationship, add, replace or remove, and persist the change
    using the service. With an id the relation will be added or changed, with
    &#x60;null&#x60; a relationship will be removed.

    See: &lt;http://jsonapi.org/format/#crud-updating-resource-relationships&gt;

    For &#x60;to-many&#x60; relationships the backend will need to support editing as a set,
    full replacement (most often that may be disabled). The list of all related
    resource identifiers will be sent to the server as a replace operation.

    Update a relationship by adding or removing using a list, id, or null. When
    adding an id for a to-many relationship send one or more ids, include the
    existing ids as well. When removing from a to-many relationship pass the ids
    that should remain, missing ids will be removed, or remove all with an empty
    array.

    Calling &#x60;this.updateRelationship&#x60; will call the service to persist the changes,
    via it&#x27;s &#x60;patchRelationship&#x60; method. Since the default &#x60;catch&#x60; for this
    method is to rollback the relationships, an optional &#x60;errorCallback&#x60; function
    can be used to handle the error response.

    @method updateRelationship
    @param {String} relationship name
    @param {Array|String|null} ids can be only one id or null to remove
    @param {Function} errorCallback &#x60;function (error) {}&#x60;
    @return {Promise}
  */
  updateRelationship(relationship, ids, errorCallback) {
    let related = this.get(relationship);
    let rollback;
    if (related.kind === &#x27;toOne&#x27;) {
      rollback = related.get(&#x27;id&#x27;);
    } else if (related.kind === &#x27;toMany&#x27;) {
      rollback = related.mapBy(&#x27;id&#x27;);
    }
    this._replaceRelationshipsData(relationship, ids);
    return this.get(&#x27;service&#x27;).patchRelationship(this, relationship)
    .catch(function (error) {
      this._updateRelationshipsData(relationship, rollback);
      if (typeof errorCallback === &#x27;function&#x27;) {
        errorCallback(error);
      } else {
        Ember.Logger.error(error);
      }
    }.bind(this));
  },

  /**
    Deletes a relationship for &#x60;to-many&#x60; relation, calls service to persist.

    See: &lt;http://jsonapi.org/format/#crud-updating-to-many-relationships&gt;

    Calling &#x60;this.deleteRelationship&#x60; will call the service to persist the changes,
    via it&#x27;s &#x60;deleteRelationship&#x60; method. Since the default &#x60;catch&#x60; for this
    method is to rollback the relationships, an optional &#x60;errorCallback&#x60; function
    can be used to handle the error response.

    @method deleteRelationship
    @param {String} relationship name (plural) to find the url
    @param {String} id of the related resource
    @param {Function} errorCallback &#x60;function (error) {}&#x60;
    @return {Promise}
  */
  deleteRelationship(relationship, id, errorCallback) {
    this.removeRelationship(relationship, id);
    return this.get(&#x27;service&#x27;).deleteRelationship(this, relationship, id)
    .catch(function (error) {
      this.addRelationship(relationship, id);
      if (typeof errorCallback === &#x27;function&#x27;) {
        errorCallback(error);
      } else {
        Ember.Logger.error(error);
      }
    }.bind(this));
  },

  _updateRelationshipsData: Ember.required
});

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
